package tests

import (
	"math"
	"testing"

	"../../ta"
)

func TestSTOCHCalculation(t *testing.T) {
	var closes []float64 = []float64{
		1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0,
		1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0,
		1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0,
		1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0,
		1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0,
		1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0,
		1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0,
		1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0,
		1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0,
		1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0,
	}

	var high []float64 = []float64{
		1.31463198, 2.24011529, 4.35090395, 5.72306104, 5.83616541, 7.48720048, 10.07346761, 10.93418835, 12.82025593, 12.79720793,
		1.42985701, 2.27846961, 3.52112016, 5.79532125, 7.25103722, 8.24901707, 9.38207988, 11.50994503, 10.21403220, 10.51589817,
		1.02628542, 2.80291187, 4.02030305, 4.76219538, 5.14120353, 8.65658136, 7.08021805, 10.95169978, 10.02914505, 13.34340464,
		1.17785031, 2.09943531, 4.30154472, 4.63942146, 6.71578780, 6.46164116, 9.93010304, 9.30014225, 12.86390307, 13.23325131,
		1.43450569, 2.49318175, 4.22576423, 5.90397482, 5.79021058, 6.15732131, 9.24122551, 8.03691993, 11.10328061, 14.94075893,
		1.15158535, 2.82058528, 3.02751880, 4.94961471, 6.21600725, 6.67537735, 9.33445194, 11.42713086, 9.49141009, 14.67260786,
		1.26604057, 2.36399110, 3.54412130, 5.13076388, 7.04124678, 8.21237812, 8.27139865, 8.03620951, 12.58231610, 10.36083825,
		1.16648531, 2.62406172, 4.46506809, 5.84697914, 6.35394185, 6.66025229, 7.72887437, 9.55836813, 12.58454343, 12.47424721,
		1.32325231, 2.25612161, 4.42149232, 4.06963890, 6.45508020, 7.84561638, 9.12005648, 9.86539953, 9.66460971, 10.20838452,
		1.46028771, 2.01339111, 3.63189769, 4.02448126, 5.53118350, 6.22192855, 7.82845249, 9.54736332, 12.07228213, 12.03786138,
	}

	var low []float64 = []float64{
		0.72616039, 1.80597976, 2.20139647, 2.53678620, 4.16885098, 3.44215391, 6.55435985, 7.93489565, 6.76890429, 7.29221287,
		0.91264056, 1.60203779, 2.42122691, 2.92867279, 3.57226757, 5.66056531, 3.53726890, 7.35290217, 5.65582567, 7.58342897,
		0.63110584, 1.14492996, 2.10050288, 3.95820571, 3.22983611, 3.10293001, 5.55146593, 7.91686284, 4.63230507, 7.97904186,
		0.89723676, 1.28874940, 2.85631481, 2.58173746, 4.60274198, 5.77233473, 4.26792994, 4.85523434, 6.24236459, 9.90154062,
		0.98456041, 1.38947772, 1.72424913, 3.31472229, 3.61431918, 4.77256160, 6.67210185, 7.47541841, 5.39501161, 6.40104112,
		0.61003153, 1.42636809, 1.54018488, 3.65000465, 4.61798633, 5.22832228, 3.68839431, 7.58274101, 8.68113834, 7.92514191,
		0.83799467, 1.18254225, 2.25926941, 3.06804425, 2.75277825, 4.48944850, 5.93398517, 6.98592001, 6.49252055, 9.44454695,
		0.64929779, 1.86333510, 2.65703581, 3.01404701, 2.68656815, 3.06354667, 6.24786292, 6.63780861, 8.91809823, 9.72840865,
		0.88275922, 1.29841046, 1.70404561, 2.68502497, 3.45298574, 4.17757103, 3.57606140, 4.48746603, 5.64599136, 5.41777762,
		0.85530878, 1.84998818, 2.93309517, 2.46152791, 2.99014222, 3.22147039, 5.47387887, 4.76199605, 5.32240416, 8.56152385,
	}

	var expected_slowk []float64 = []float64{
		math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 72.80551296121735, 68.93194647539772, 64.09801433805788,
		67.0126174817263, 33.87313046496793, 21.50238049529254, 19.515999049158644, 22.7469428486475, 43.616321306173845, 54.89057316513555,
		60.33474071795659, 59.71617773954917, 64.11716957822424, 72.58908543043191, 37.99000926986037, 25.286549790126106, 24.62579349998351,
		29.353690565029847, 63.111429855781665, 63.872643532964275, 69.30238697563442, 65.84761110168232, 70.49064827146793, 68.92086281533128,
		34.87326225243165, 21.866762756418453, 19.380813793848475, 22.155140098000103, 46.333454304335206, 66.57208245608436, 63.34893407067074,
		68.5415940244093, 61.795720534156146, 62.86587247454231, 31.495961707201168, 19.89307520813279, 18.17370084320079, 21.39608254533698,
		51.51021173992538, 74.10528968964626, 72.14488541668987, 75.60062261541668, 73.75777263489266, 62.58372971469775, 32.652467355446774,
		21.175842602668816, 18.926536653127368, 21.290890105204173, 49.799810762198845, 68.46652608467959, 69.2578206945894, 62.595509014593425,
		65.6160547600686, 61.53837599019948, 31.354695257843815, 19.87697834516024, 17.75224334231271, 20.303999294383203, 43.698962241945786,
		56.11384972848634, 67.48331109741736, 81.28271988790476, 72.41915990430351, 70.2553086874149, 36.59711580303542, 23.95807410651715,
		21.82860800392948, 28.165440543077395, 52.21570599545431, 69.22580496720862, 77.42739804199607, 77.37483486214923, 70.57995944801124,
		71.71711810484044, 36.35951163322328, 22.95356107549361, 20.523438474707685, 23.707968686472242, 48.79766359984635, 60.30414467268524,
		65.85829285594657, 69.93957663316303, 78.22194297829745, 87.53999465169935, 44.543492719355385, 28.391076790760035, 25.660703864038993,
		29.641352438255108, 59.140632036934406, 77.03221472684322, 80.79797682468391, 79.48028066324396, 72.82627333306789, 74.70640178799951,
	}

	var expected_slowd []float64 = []float64{
		math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 68.61182459155765, 67.81222103664197,
		50.84267575080495, 36.17252812304875, 27.844263586103697, 25.2956032173756, 34.45596226177472, 44.67326771345513, 52.50400421570586,
		56.110090977627515, 60.11363027792588, 66.3513578541789, 52.17068356201963, 38.72861667607287, 31.677205088028188, 30.51544782652902,
		46.813438841155346, 55.34304118705981, 62.322714081347115, 64.08516259151472, 67.28790543149132, 68.10438412341131, 51.48882318792148,
		36.67779297216997, 28.02930338300922, 25.092221740504662, 35.71283802241993, 51.142460239252145, 57.24569715496144, 62.89364558968538,
		62.34468306192076, 62.60527776823153, 47.050619737716346, 33.471847472924566, 25.82277415806268, 23.60942835169983, 37.55982004581261,
		55.83255486772943, 63.98872014220965, 69.79467137881316, 71.77622200685292, 67.17997586077533, 49.91622160811105, 35.54603210538993,
		27.23628437925865, 24.26358724223141, 37.03169900221513, 52.74911254344735, 61.003466619018376, 61.7994878168059, 63.70777128843724,
		62.62307363931836, 46.98888444858109, 33.432931396870664, 25.592587369591687, 22.948293331987443, 33.32362778696661, 44.71873875772648,
		56.10102492757191, 68.69187240773834, 70.55551615602093, 70.40541242171791, 53.50126411237667, 38.72966910944691, 30.279138556688196,
		29.222289549882795, 40.71899777266855, 54.97240136993858, 66.19989970596733, 71.78736728405828, 71.18366336603475, 71.4503907354376,
		53.904951184330436, 38.42925612991202, 29.476347302309854, 26.592157994391048, 37.6949107971187, 48.999527734901974, 57.428910295424274,
		63.68424346429365, 70.95309322129555, 79.24654393649745, 61.895018327926415, 45.14304755934322, 35.401875711691105, 32.52161407497311,
		45.83112305595375, 61.43166889139849, 71.11482285804121, 75.29755176064259, 74.06191254685524, 74.38415716742738,
	}

	slowk, slowd, err := ta.STOCH(high, low, closes, 5, 3, 3)
	if err != nil {
		t.Errorf(err.Error())
	}
	compare_inp_exp(t, slowk, expected_slowk, 8, "SLOWK")
	compare_inp_exp(t, slowd, expected_slowd, 8, "SLOWD")
}
